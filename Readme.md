# MFDP - Медицинская платформа машинного обучения

## Описание

MFDP (Medical Forecasting and Data Processing) - это комплексная платформа машинного обучения для медицинских учреждений, которая включает:

- 🤖 **Прогнозирование неявок пациентов** - ML модель для предсказания вероятности неявки на прием
- 👨‍⚕️ **Оптимизация загрузки врачей** - алгоритмы балансировки нагрузки и расписания
- ⚡ **Адаптивное планирование** - обработка событий в реальном времени
- 📊 **Аналитика и отчетность** - детальная аналитика и построение отчетов
- 🔐 **Безопасность и аудит** - система аутентификации и логирования действий

## Быстрый запуск

### Требования
- Docker 20.10+ с Docker Compose
- 4 ГБ RAM
- 2 ГБ свободного места

### Автоматический запуск

**Windows:**
```cmd
start.bat
```

**Linux/macOS:**
```bash
chmod +x start.sh
./start.sh
```

### Ручной запуск
```bash
# 1. Переход в директорию проекта
cd MFDP_private/MFDP_main

# 2. Создание .env файла
cat > .env << EOF
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB=medical_db
REDIS_HOST=redis
REDIS_PORT=6379
RABBITMQ_HOST=rabbitmq
RABBITMQ_PORT=5672
RABBITMQ_USER=rmuser
RABBITMQ_PASSWORD=rmpassword
SECRET_KEY=ef7cb39b5097a96e496ee87383cf9d853706151497015a826120db8e25084ef3
DEBUG=True
LOG_LEVEL=INFO
ML_MODEL_PATH=./models
EOF

# 3. Создание директорий
mkdir -p models

# 4. Запуск системы
docker-compose up -d

# 5. Ожидание готовности (30 секунд)
sleep 30
```

## Доступ к системе

После успешного запуска система будет доступна по следующим адресам:

- 🌐 **Веб-интерфейс**: http://localhost:80
- 📚 **API документация**: http://localhost:8080/api/docs
- 🔍 **Health check**: http://localhost:8080/health
- 🧪 **Тестовая страница**: http://localhost:80/test_integration.html

### Учетные данные по умолчанию
- **Логин**: `admin`
- **Пароль**: `admin`

## Архитектура системы

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Nginx (80)    │    │   FastAPI (8080)│    │  ML Worker      │
│   (Фронтенд)    │◄──►│   (API)         │◄──►│  (Обработка ML) │
└─────────────────┘    └─────────────────┘    └─────────────────┘
                                │
                                ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   PostgreSQL    │    │     Redis       │    │   RabbitMQ      │
│   (База данных) │    │   (Кэш)         │    │ (Очередь задач) │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## Основные модули

### 1. Прогнозирование неявок
- ML модель для предсказания вероятности неявки пациента
- Анализ факторов риска (возраст, расстояние, история неявок)
- Генерация рекомендаций для снижения риска

### 2. Оптимизация врачей
- Балансировка нагрузки между врачами
- Минимизация времени ожидания пациентов
- Оптимизация использования ресурсов

### 3. Адаптивное планирование
- Обработка событий в реальном времени
- Автоматическое перепланирование при отменах
- Управление экстренными случаями

### 4. Аналитика и отчеты
- Дашборд с ключевыми метриками
- Детальная аналитика по пациентам и врачам
- Генерация отчетов в различных форматах

## API Endpoints

### Основные endpoints
- `GET /health` - проверка работоспособности
- `GET /api/docs` - документация API
- `POST /auth/login` - аутентификация

### ML модули
- `POST /api/no-show-prediction/predict` - прогнозирование неявок
- `POST /api/doctor-load-optimization/optimize-schedule` - оптимизация расписания
- `POST /api/real-time-scheduler/event` - обработка событий

### Аналитика
- `GET /api/analytics/dashboard` - дашборд аналитики
- `GET /api/analytics/patient-flow` - поток пациентов
- `GET /api/analytics/model-metrics` - метрики моделей

## Управление системой

### Полезные команды
```bash
# Просмотр статуса сервисов
docker-compose ps

# Просмотр логов
docker-compose logs -f

# Остановка системы
docker-compose down

# Перезапуск конкретного сервиса
docker-compose restart app

# Просмотр использования ресурсов
docker stats
```

### Мониторинг
```bash
# Проверка логов ошибок
docker-compose logs app | grep ERROR

# Проверка состояния базы данных
docker-compose exec postgres psql -U postgres -d medical_db -c "\dt"

# Проверка очереди сообщений
docker-compose exec rabbitmq rabbitmqctl status
```

## Устранение неполадок

### Частые проблемы

**Проблема**: Порты заняты
```bash
# Проверка занятых портов
netstat -an | findstr :80  # Windows
lsof -i :80               # Linux/macOS

# Остановка системы
docker-compose down
```

**Проблема**: База данных не инициализирована
```bash
# Инициализация БД
docker-compose exec app python -m app.database.initdb
```

**Проблема**: Контейнеры не запускаются
```bash
# Полная пересборка
docker-compose down --rmi all --volumes
docker-compose up -d --build
```

## Документация

- 📖 [Подробная инструкция по запуску](ИНСТРУКЦИЯ_ПО_ЗАПУСКУ.md)
- ⚡ [Быстрый запуск](БЫСТРЫЙ_ЗАПУСК.md)
- 🔧 [Руководство по настройке](SETUP_GUIDE.md)
- 🐛 [Устранение неполадок](TROUBLESHOOTING.md)
- 👤 [Руководство пользователя](USER_GUIDE.md)
- 🔌 [Руководство по API](API_GUIDE.md)
- 🎨 [Руководство по фронтенду](FRONTEND_API_GUIDE.md)

## Разработка

### Структура проекта
```
MFDP_main/
├── app/                    # Основное приложение (FastAPI)
│   ├── api.py             # Точка входа приложения
│   ├── models/            # Модели данных
│   ├── routes/            # API маршруты
│   ├── services/          # Бизнес-логика
│   └── database/          # Работа с БД
├── ml_worker/             # ML воркер
├── interface/             # Фронтенд
├── nginx/                 # Веб-сервер
├── docker-compose.yaml    # Конфигурация Docker
└── README.md             # Документация
```

### Локальная разработка
```bash
# Установка зависимостей
pip install -r app/requirements.txt

# Запуск в режиме разработки
cd app
uvicorn api:app --reload --host 0.0.0.0 --port 8080
```

## Лицензия

Проект разработан для внутреннего использования медицинскими учреждениями.

## Поддержка

Для получения поддержки обратитесь к документации или создайте issue в репозитории проекта.

---

**MFDP Team** | Версия 1.0 | 2024

